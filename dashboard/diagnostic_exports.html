<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exports Error Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; background: #e6ffe6; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .info { color: blue; background: #e6f3ff; padding: 10px; margin: 10px 0; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>JavaScript Error Diagnostic Tool</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function logResult(type, message) {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function logInfo(message) { logResult('info', message); }
        function logSuccess(message) { logResult('success', message); }
        function logError(message) { logResult('error', message); }
        
        // Capture all errors with detailed stack traces
        window.onerror = function(message, source, lineno, colno, error) {
            logError(`
                <strong>JavaScript Error Detected:</strong><br>
                <strong>Message:</strong> ${message}<br>
                <strong>Source:</strong> ${source}<br>
                <strong>Line:</strong> ${lineno}<br>
                <strong>Column:</strong> ${colno}<br>
                <strong>Stack:</strong><br>
                <pre>${error ? error.stack : 'No stack trace available'}</pre>
            `);
            
            if (message.includes('exports')) {
                logError(`<strong>ðŸŽ¯ EXPORTS ERROR FOUND!</strong><br>This is the error we're looking for.`);
            }
            
            return false; // Don't suppress default error handling
        };
        
        // Capture unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            logError(`
                <strong>Unhandled Promise Rejection:</strong><br>
                <strong>Reason:</strong> ${event.reason}<br>
                <strong>Stack:</strong><br>
                <pre>${event.reason?.stack || 'No stack trace available'}</pre>
            `);
        });
        
        logInfo('Error capture system initialized. Loading scripts...');
    </script>

    <!-- Test Chart.js first -->
    <script>
        logInfo('Loading Chart.js...');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        if (typeof Chart !== 'undefined') {
            logSuccess('âœ“ Chart.js loaded successfully');
        } else {
            logError('âœ— Chart.js failed to load');
        }
    </script>

    <!-- Test date-fns -->
    <script>
        logInfo('Loading date-fns...');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script>
        if (typeof dateFns !== 'undefined') {
            logSuccess('âœ“ date-fns loaded successfully');
        } else {
            logError('âœ— date-fns failed to load or not available as dateFns');
        }
        
        // Check various ways date-fns might be available
        if (typeof window.dateFns !== 'undefined') {
            logSuccess('âœ“ date-fns available as window.dateFns');
        }
        if (typeof window.format !== 'undefined') {
            logSuccess('âœ“ date-fns format function available globally');
        }
    </script>

    <!-- Test our dashboard script -->
    <script>
        logInfo('Loading enhanced_dashboard.js...');
    </script>
    <script src="enhanced_dashboard.js"></script>
    <script>
        if (typeof DashboardManager !== 'undefined') {
            logSuccess('âœ“ DashboardManager loaded successfully');
            
            try {
                const dashboard = new DashboardManager();
                logSuccess('âœ“ DashboardManager instance created successfully');
            } catch (error) {
                logError(`âœ— Error creating DashboardManager: ${error.message}<br><pre>${error.stack}</pre>`);
            }
        } else {
            logError('âœ— DashboardManager not available');
        }
    </script>

    <script>
        logInfo('All script loading tests completed.');
        
        // Additional diagnostic information
        logInfo(`
            <strong>Browser Information:</strong><br>
            User Agent: ${navigator.userAgent}<br>
            Platform: ${navigator.platform}<br>
            Language: ${navigator.language}
        `);
        
        // Check for any global exports or module variables
        if (typeof exports !== 'undefined') {
            logInfo('exports variable is defined globally');
        }
        if (typeof module !== 'undefined') {
            logInfo('module variable is defined globally');
        }
        if (typeof require !== 'undefined') {
            logInfo('require function is defined globally');
        }
    </script>
</body>
</html>
