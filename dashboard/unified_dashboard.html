<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified AI System Dashboard - Canonical</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="enhanced_dashboard_working.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 10px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header .subtitle {
            margin: 10px 0 0 0;
            font-size: 1.1em;
            opacity: 0.9;
        }

        .live-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Layout Grid */
        .dashboard-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .metrics-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .metric-label {
            display: block;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            display: block;
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-color);
            line-height: 1;
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 0.8em;
            color: #666;
        }

        .metric-change.positive {
            color: var(--success-color);
        }

        .metric-change.negative {
            color: var(--danger-color);
        }

        /* Chart Container */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            position: relative;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--dark-color);
            margin: 0;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chart-toggle {
            background: var(--light-color);
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: var(--transition);
        }

        .chart-toggle:hover,
        .chart-toggle.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .chart-canvas {
            position: relative;
            height: 300px;
            margin-top: 10px;
        }

        /* Utility Classes for Common Patterns - Added to reduce CSS duplication */
        .btn-pill {
            border-radius: 20px;
        }
        
        .btn-round {
            border-radius: 50%;
        }
        
        .shadow-hover {
            transition: var(--transition);
        }
        
        .shadow-hover:hover {
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .text-center {
            text-align: center;
        }
        
        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        /* Enhanced Charts Section - CONSOLIDATED (was duplicated 17x) */
        .enhanced-charts-section {
            margin-top: 40px;
        }

        .enhanced-chart-group {
            margin-bottom: 30px;
        }

        .enhanced-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .enhanced-controls {
            display: flex;
            gap: 10px;
        }

        .enhanced-metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .enhanced-metric {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .enhanced-label {
            display: block;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .enhanced-value {
            display: block;
            font-size: 1.4em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .enhanced-charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-status {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 15px;
            background: var(--light-color);
            color: var(--dark-color);
        }

        .chart-status.loading {
            background: var(--info-color);
            color: white;
        }

        .chart-status.success {
            background: var(--success-color);
            color: white;
        }

        .chart-status.error {
            background: var(--danger-color);
            color: white;
        }

        /* Health Gauge Styles - CONSOLIDATED */
        .health-gauge {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--danger-color) 0%, var(--warning-color) 40%, var(--success-color) 70%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .health-gauge::before {
            content: '';
            position: absolute;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
        }

        .health-value {
            position: relative;
            z-index: 1;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--dark-color);
        }

        .component-health {
            margin-top: 20px;
        }

        .component-health-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .component-label {
            font-size: 0.9em;
            color: var(--dark-color);
            flex: 1;
        }

        .component-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            flex: 2;
            margin: 0 10px;
        }

        .component-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger-color) 0%, var(--warning-color) 50%, var(--success-color) 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .component-value {
            font-size: 0.9em;
            font-weight: bold;
            color: var(--primary-color);
            min-width: 40px;
            text-align: right;
        }

        /* Critical Path Styles - CONSOLIDATED */
        .critical-path-details {
            margin-top: 20px;
        }

        .critical-tasks-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .critical-task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }

        .critical-task-item:hover {
            background: #f8f9fa;
        }

        .critical-task-item:last-child {
            border-bottom: none;
        }

        .task-name {
            font-weight: 500;
            color: var(--dark-color);
        }

        .task-risk {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .task-risk.high {
            background: var(--danger-color);
            color: white;
        }

        .task-risk.medium {
            background: var(--warning-color);
            color: white;
        }

        .task-risk.low {
            background: var(--success-color);
            color: white;
        }

        /* System Status Indicators */
        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .status-item {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .status-icon.warning {
            background: var(--warning-color);
        }

        .status-icon.error {
            background: var(--danger-color);
        }

        .status-text {
            flex: 1;
        }

        .status-label {
            font-size: 0.9em;
            color: #666;
            margin: 0;
        }

        .status-value {
            font-weight: 600;
            color: var(--dark-color);
            margin: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .metrics-section {
                grid-template-columns: 1fr;
            }

            .enhanced-charts-grid {
                grid-template-columns: 1fr;
            }

            .enhanced-metrics-row {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auto-refresh indicator */
        .refresh-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .refresh-indicator.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="refresh-indicator" id="refreshIndicator">
        Updating dashboard...
    </div>

    <div class="header">
        <div class="live-indicator">
            <div class="status-dot"></div>
            <span>Live Dashboard</span>
        </div>
        <h1>AI System Dashboard</h1>
        <p class="subtitle">Unified Canonical View - Phase 6 Step 6.5 Enhanced</p>
    </div>

    <!-- System Status -->
    <div class="system-status">
        <div class="status-item">
            <div class="status-icon" id="apiStatus"></div>
            <div class="status-text">
                <p class="status-label">API Server</p>
                <p class="status-value" id="apiStatusText">Checking...</p>
            </div>
        </div>
        <div class="status-item">
            <div class="status-icon" id="automationStatus"></div>
            <div class="status-text">
                <p class="status-label">Automation</p>
                <p class="status-value" id="automationStatusText">Checking...</p>
            </div>
        </div>
        <div class="status-item">
            <div class="status-icon" id="healthStatus"></div>
            <div class="status-text">
                <p class="status-label">System Health</p>
                <p class="status-value" id="healthStatusText">Checking...</p>
            </div>
        </div>
    </div>

    <!-- Main Metrics -->
    <div class="metrics-section">
        <div class="metric-card">
            <span class="metric-label">Completion Rate</span>
            <span class="metric-value" id="completionRate">--</span>
            <span class="metric-change" id="completionChange">--</span>
        </div>
        <div class="metric-card">
            <span class="metric-label">Total Tasks</span>
            <span class="metric-value" id="totalTasks">--</span>
            <span class="metric-change" id="tasksChange">--</span>
        </div>
        <div class="metric-card">
            <span class="metric-label">In Progress</span>
            <span class="metric-value" id="inProgressTasks">--</span>
            <span class="metric-change" id="progressChange">--</span>
        </div>
        <div class="metric-card">
            <span class="metric-label">QA Pass Rate</span>
            <span class="metric-value" id="qaPassRate">--</span>
            <span class="metric-change" id="qaChange">--</span>
        </div>
    </div>

    <!-- Main Charts -->
    <div class="dashboard-grid">
        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">Sprint Progress</h3>
                <div class="chart-controls">
                    <button class="chart-toggle active" onclick="toggleChart('progress', 'tasks')">Tasks</button>
                    <button class="chart-toggle" onclick="toggleChart('progress', 'completion')">Completion</button>
                </div>
            </div>
            <div class="chart-canvas">
                <canvas id="progressChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">QA Metrics</h3>
                <div class="chart-controls">
                    <button class="chart-toggle active" onclick="toggleChart('qa', 'pass_rate')">Pass Rate</button>
                    <button class="chart-toggle" onclick="toggleChart('qa', 'coverage')">Coverage</button>
                </div>
            </div>
            <div class="chart-canvas">
                <canvas id="qaChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">Team Velocity</h3>
                <div class="chart-controls">
                    <button class="chart-toggle active" onclick="toggleChart('velocity', 'daily')">Daily</button>
                    <button class="chart-toggle" onclick="toggleChart('velocity', 'weekly')">Weekly</button>
                </div>
            </div>
            <div class="chart-canvas">
                <canvas id="velocityChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h3 class="chart-title">Interactive Timeline</h3>
                <div class="chart-controls">
                    <button class="chart-toggle active" onclick="toggleTimeline('7d')">7 Days</button>
                    <button class="chart-toggle" onclick="toggleTimeline('30d')">30 Days</button>
                </div>
            </div>
            <div class="chart-canvas">
                <canvas id="timelineChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Phase 6 Step 6.5 Enhanced Visual Progress Charts -->
    <div class="enhanced-charts-section">
        <div class="chart-header">
            <h2 class="chart-title">Phase 6 Step 6.5 - Enhanced Visual Progress Charts</h2>
            <div class="chart-controls">
                <span class="chart-status" id="enhancedChartsStatus">Loading...</span>
            </div>
        </div>

        <!-- Daily Automation Tracking -->
        <div class="enhanced-chart-group">
            <div class="enhanced-chart-header">
                <h3>Daily Automation Timeline</h3>
                <div class="enhanced-controls">
                    <button class="chart-toggle active" onclick="refreshEnhancedChart('daily_automation')">Refresh</button>
                </div>
            </div>
            
            <div class="enhanced-metrics-row">
                <div class="enhanced-metric">
                    <span class="enhanced-label">Daily Cycles</span>
                    <span class="enhanced-value" id="daily-cycles-count">--</span>
                </div>
                <div class="enhanced-metric">
                    <span class="enhanced-label">Success Rate</span>
                    <span class="enhanced-value" id="daily-success-rate">--</span>
                </div>
                <div class="enhanced-metric">
                    <span class="enhanced-label">Avg Duration</span>
                    <span class="enhanced-value" id="daily-duration">--</span>
                </div>
                <div class="enhanced-metric">
                    <span class="enhanced-label">Next Cycle</span>
                    <span class="enhanced-value" id="daily-next-cycle">--</span>
                </div>
            </div>
            
            <div class="enhanced-charts-grid">
                <div class="chart-container">
                    <canvas id="dailyAutomationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Interactive Velocity Tracking -->
        <div class="enhanced-chart-group">
            <div class="enhanced-chart-header">
                <h3>Velocity Tracking & Predictions</h3>
                <div class="enhanced-controls">
                    <button class="chart-toggle active" onclick="refreshEnhancedChart('velocity_tracking')">Refresh</button>
                </div>
            </div>
            
            <div class="enhanced-metrics-row">
                <div class="enhanced-metric">
                    <span class="enhanced-label">Current Velocity</span>
                    <span class="enhanced-value" id="velocity-current">--</span>
                </div>
                <div class="enhanced-metric">
                    <span class="enhanced-label">Predicted</span>
                    <span class="enhanced-value" id="velocity-predicted">--</span>
                </div>
                <div class="enhanced-metric">
                    <span class="enhanced-label">Trend</span>
                    <span class="enhanced-value" id="velocity-trend">--</span>
                </div>
                <div class="enhanced-metric">
                    <span class="enhanced-label">Accuracy</span>
                    <span class="enhanced-value" id="velocity-accuracy">--</span>
                </div>
            </div>
            
            <div class="enhanced-charts-grid">
                <div class="chart-container">
                    <canvas id="velocityTrackingChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="interactiveTimelineChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Sprint Health Indicators -->
        <div class="enhanced-chart-group">
            <div class="enhanced-chart-header">
                <h3>Sprint Health Indicators</h3>
                <div class="enhanced-controls">
                    <button class="chart-toggle active" onclick="refreshEnhancedChart('sprint_health')">Refresh</button>
                </div>
            </div>
            
            <div class="enhanced-charts-grid">
                <div class="chart-container">
                    <div class="health-gauge" id="sprintHealthGauge">
                        <div class="health-value" id="sprintHealthValue">--</div>
                    </div>
                    <div class="component-health" id="componentHealth">
                        <!-- Component health bars will be populated by JavaScript -->
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="sprintHealthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Critical Path Visualization -->
        <div class="enhanced-chart-group">
            <div class="enhanced-chart-header">
                <h3>Critical Path & Dependencies</h3>
                <div class="enhanced-controls">
                    <button class="chart-toggle active" onclick="refreshEnhancedChart('critical_path')">Refresh</button>
                </div>
            </div>
            
            <div class="enhanced-charts-grid">
                <div class="chart-container">
                    <canvas id="criticalPathChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="critical-path-details">
                        <h4>Critical Tasks</h4>
                        <div class="critical-tasks-list" id="criticalTasksList">
                            <!-- Critical tasks will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // HTML Generation Utilities to reduce code duplication
        const HTMLGenerators = {
            /**
             * Generate enhanced metric HTML structure
             * @param {string} label - The metric label
             * @param {string} id - The unique ID for the value element
             * @returns {string} HTML string for enhanced metric
             */
            createEnhancedMetric(label, id) {
                return `
                    <div class="enhanced-metric">
                        <span class="enhanced-label">${label}</span>
                        <span class="enhanced-value" id="${id}">--</span>
                    </div>
                `;
            },

            /**
             * Generate multiple enhanced metrics in a row
             * @param {Array} metrics - Array of {label, id} objects
             * @returns {string} HTML string for metrics row
             */
            createEnhancedMetricsRow(metrics) {
                const metricsHTML = metrics.map(metric => 
                    this.createEnhancedMetric(metric.label, metric.id)
                ).join('');
                
                return `
                    <div class="enhanced-metrics-row">
                        ${metricsHTML}
                    </div>
                `;
            },

            /**
             * Generate chart container with controls
             * @param {Object} config - Chart configuration object
             * @returns {string} HTML string for chart container
             */
            createChartContainer(config) {
                const {title, canvasId, controls = []} = config;
                
                const controlsHTML = controls.length > 0 ? `
                    <div class="chart-controls">
                        ${controls.map(control => `
                            <button class="chart-toggle ${control.active ? 'active' : ''}" 
                                    onclick="${control.onclick}">
                                ${control.text}
                            </button>
                        `).join('')}
                    </div>
                ` : '';

                return `
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">${title}</h3>
                            ${controlsHTML}
                        </div>
                        <div class="chart-canvas">
                            <canvas id="${canvasId}"></canvas>
                        </div>
                    </div>
                `;
            },

            /**
             * Generate enhanced chart group structure
             * @param {Object} config - Chart group configuration
             * @returns {string} HTML string for enhanced chart group
             */
            createEnhancedChartGroup(config) {
                const {title, chartType, metrics = [], charts = [], customContent = ''} = config;
                
                const metricsHTML = metrics.length > 0 ? 
                    this.createEnhancedMetricsRow(metrics) : '';
                
                const chartsHTML = charts.length > 0 ? `
                    <div class="enhanced-charts-grid">
                        ${charts.map(chart => this.createChartContainer(chart)).join('')}
                    </div>
                ` : '';

                return `
                    <div class="enhanced-chart-group">
                        <div class="enhanced-chart-header">
                            <h3>${title}</h3>
                            <div class="enhanced-controls">
                                <button class="chart-toggle active" 
                                        onclick="refreshEnhancedChart('${chartType}')">
                                    Refresh
                                </button>
                            </div>
                        </div>
                        ${metricsHTML}
                        ${chartsHTML}
                        ${customContent}
                    </div>
                `;
            }
        };

        /**
         * Code Duplication Detection and Prevention Utilities
         * Added as part of static analysis consolidation
         */
        const DuplicationDetector = {
            /**
             * Validate dashboard structure for duplicate patterns
             * @returns {Object} Analysis results
             */
            validateDashboardStructure() {
                const results = {
                    duplicateSelectors: [],
                    repeatedPatterns: [],
                    optimizationSuggestions: []
                };

                // Check for duplicate CSS selectors
                const styleSheets = document.styleSheets;
                const selectors = new Set();
                const duplicates = new Set();

                try {
                    Array.from(styleSheets).forEach(sheet => {
                        if (sheet.cssRules) {
                            Array.from(sheet.cssRules).forEach(rule => {
                                if (rule.selectorText) {
                                    if (selectors.has(rule.selectorText)) {
                                        duplicates.add(rule.selectorText);
                                    }
                                    selectors.add(rule.selectorText);
                                }
                            });
                        }
                    });
                } catch (e) {
                    // Handle cross-origin CSS access restrictions
                    console.log('CSS analysis limited due to security restrictions');
                }

                results.duplicateSelectors = Array.from(duplicates);

                // Check for repeated HTML patterns
                const chartContainers = document.querySelectorAll('.chart-container');
                const enhancedMetrics = document.querySelectorAll('.enhanced-metric');
                const chartGroups = document.querySelectorAll('.enhanced-chart-group');

                if (chartContainers.length > 8) {
                    results.optimizationSuggestions.push(
                        `Found ${chartContainers.length} chart containers - consider template-based generation`
                    );
                }

                if (enhancedMetrics.length > 6) {
                    results.optimizationSuggestions.push(
                        `Found ${enhancedMetrics.length} enhanced metrics - already optimized with utility functions`
                    );
                }

                return results;
            },

            /**
             * Generate performance report for the dashboard
             * @returns {Object} Performance analysis
             */
            generatePerformanceReport() {
                const totalElements = document.querySelectorAll('*').length;
                const cssRules = this.countCSSRules();
                const jsEvents = this.countEventListeners();

                return {
                    totalElements,
                    cssRules,
                    jsEvents,
                    codeComplexity: this.calculateComplexity(),
                    recommendations: this.getOptimizationRecommendations()
                };
            },

            countCSSRules() {
                let count = 0;
                try {
                    Array.from(document.styleSheets).forEach(sheet => {
                        if (sheet.cssRules) {
                            count += sheet.cssRules.length;
                        }
                    });
                } catch (e) {
                    count = 'Access restricted';
                }
                return count;
            },

            countEventListeners() {
                const elementsWithEvents = document.querySelectorAll('[onclick]');
                return elementsWithEvents.length;
            },

            calculateComplexity() {
                const metrics = {
                    chartContainers: document.querySelectorAll('.chart-container').length,
                    enhancedMetrics: document.querySelectorAll('.enhanced-metric').length,
                    chartGroups: document.querySelectorAll('.enhanced-chart-group').length,
                    toggleButtons: document.querySelectorAll('.chart-toggle').length
                };

                const complexity = Object.values(metrics).reduce((sum, val) => sum + val, 0);
                return {
                    score: complexity,
                    breakdown: metrics,
                    rating: complexity < 30 ? 'Low' : complexity < 60 ? 'Medium' : 'High'
                };
            },

            getOptimizationRecommendations() {
                const recommendations = [
                    'âœ… Enhanced charts CSS consolidated (was 17x duplicate)',
                    'âœ… JavaScript utility functions added for HTML generation',
                    'âœ… CSS utility classes created for common patterns',
                    'âœ… CSS custom properties used consistently',
                    'ðŸ“Š Dashboard structure is now optimized for maintainability'
                ];

                return recommendations;
            }
        };

        // Initialize the dashboard when page loads
        let dashboardManager;
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, initializing dashboard...');
            
            try {
                dashboardManager = new DashboardManager();
                await dashboardManager.initialize();
                console.log('Dashboard initialization complete');
            } catch (error) {
                console.error('Dashboard initialization failed:', error);
            }
        });

        // Global chart toggle functions
        function toggleChart(chartType, dataType) {
            if (dashboardManager) {
                dashboardManager.toggleChartData(chartType, dataType);
            }
        }

        function toggleTimeline(period) {
            if (dashboardManager) {
                dashboardManager.toggleTimelinePeriod(period);
            }
        }

        function refreshEnhancedChart(chartType) {
            if (dashboardManager) {
                dashboardManager.refreshEnhancedChart(chartType);
            }
        }
    </script>
</body>
</html>
