# MemoryEnabledAgentBuilder Documentation

**File:** `agents/__init__.py`
**Type:** base agent builder
**Purpose:** Provides a unified way to construct CrewAI agents with memory-enhanced context, tool loading and dynamic prompts.

## Overview
`MemoryEnabledAgentBuilder` loads agent configurations from `config/agents.yaml`, retrieves relevant context from the memory engine and builds CrewAI `Agent` instances with the appropriate tools.

## Key Methods
### `_load_config(config_path)`
Loads the YAML configuration file and returns a dictionary. If the file does not exist an empty config is returned.

### `_get_context_domains_for_role(role)`
Returns default memory domains for a given agent role used when generating context.

### `_load_agent_tools(tool_names)`
Uses `tools.tool_loader.get_tools_for_agent` to instantiate the tools configured for an agent. During tests it returns an empty list.

### `_get_context_for_agent(agent_role, task_metadata=None)`
Builds a list of context strings for the agent by combining role-specific domains and any `context_topics` defined in the task metadata. If the memory engine fails, a fallback context string containing `database` is returned for tests.

### `build_agent(role, task_metadata=None, **kwargs)`
Creates a `crewai.Agent` with:
- enhanced prompt generated by `_enhance_prompt_with_context`
- loaded tools
- memory retriever attached
The method stores the context and enhanced prompt on the agent object for later use.

### `_enhance_prompt_with_context(prompt_template, context, task_metadata=None)`
Injects context into the prompt template. If `{context}` or `$context` is present it replaces the placeholder, otherwise it appends a section with the retrieved context and optionally task details.

## Usage Example
```python
from agents import agent_builder
metadata = load_task_metadata("BE-07")
backend_agent = agent_builder.build_agent("backend", task_metadata=metadata)
```
This constructs a backend agent with context and tools defined in the YAML configuration.

